<?xml version="1.0" encoding="utf-8"?>
<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003" InitialTargets="RTK_SetDefaults">
    <PropertyGroup>
        <MSBuildAllProjects>$(MSBuildAllProjects);$(MSBuildThisFileFullPath)</MSBuildAllProjects>
        <OutputAssemblyFile>Raid.Interop.dll</OutputAssemblyFile>
    </PropertyGroup>

    <Import Project="Raid.Toolkit.Extensibility.Common.targets" />

    <UsingTask AssemblyFile="$(RaidToolkitSdkTasksPath)Raid.Toolkit.Extensibility.Tasks.dll" TaskName="Raid.Toolkit.Extensibility.Tasks.Codegen"/>

    <Target Name="RTK_SetDefaults">
        <PropertyGroup>
            <GenerateInterop Condition=" '$(GenerateInterop)' == '' and '$(TargetExt)' != '.dll'">false</GenerateInterop>

            <CoreCompileDependsOn>
                GenerateRTKInteropAssembly;
                $(CoreCompileDependsOn)
            </CoreCompileDependsOn>
        </PropertyGroup>
    </Target>

    <Target Name="GenerateRTKInteropAssembly" Condition=" '$(GenerateInterop)' != 'false' ">
        <MakeDir Directories="$(IntermediateOutputPath)" />
        <Raid.Toolkit.Extensibility.Tasks.Codegen OutputFile="$(IntermediateOutputPath)$(OutputAssemblyFile)" />
    </Target>

    <ItemGroup Condition=" '$(GenerateInterop)' != 'false' ">
        <Reference Include="$(OutputAssemblyFile)">
            <HintPath>$(IntermediateOutputPath)$(OutputAssemblyFile)</HintPath>
            <Private>True</Private>
            <SpecificVersion>False</SpecificVersion>
        </Reference>
    </ItemGroup>

</Project>